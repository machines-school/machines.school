---
import ThemeIcon from './ThemeIcon.astro';
---

<header class="fixed flex top-0 left-0 right-0 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-700 h-16 z-50">
    <nav class="container mx-auto flex justify-between items-center px-4 relative">
        <h2 class="font-bold text-xl">
            <a href="/" class="flex items-center gap-2 text-gray-900 dark:text-white">
                <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M21 5.12402H24V13.2139H21V7.82031H18V21.3037H21V24H15V15.9102H9V24H3V21.3037H6V7.82031H3V13.2139H0V5.12402H15V2.69727H21V5.12402ZM18 2.69629H9V5.12305H3V2.42676H6V0H18V2.69629Z"
                        fill="currentColor"></path>
                </svg>
                <span>Machines School</span>
            </a>
        </h2>

        <button 
            id="hamburger-button"
            class="md:hidden flex flex-col justify-center items-center w-8 h-8 space-y-1.5 text-gray-900 dark:text-white relative z-50"
            aria-label="Toggle mobile menu"
        >
            <span class="block w-6 h-0.5 bg-current transition-all duration-300 ease-out hamburger-line"></span>
            <span class="block w-6 h-0.5 bg-current transition-all duration-300 ease-out hamburger-line"></span>
            <span class="block w-6 h-0.5 bg-current transition-all duration-300 ease-out hamburger-line"></span>
        </button>

        <ul class="hidden md:flex items-center gap-4">
            <li>
                <a href="/the-rise-of-intelligence" class="text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300">The Rise of Intelligence</a>
            </li>
            <li>
                <a href="/blog" class="text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300">บทความ</a>
            </li>
            <li>
                <a href="/courses" class="text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300">คอร์สเรียน</a>
            </li>
            <li>
                <a
                    href="https://github.com/machines-school"
                    target="_blank"
                    class="text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300"
                >
                    <span class="sr-only">Go to Machines School's GitHub repo</span>
                    <svg
                        viewBox="0 0 16 16"
                        aria-hidden="true"
                        width="24"
                        height="24"
                        ><path
                            fill="currentColor"
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
                        ></path></svg>
                </a>
            </li>
            <li>
                <ThemeIcon />
            </li>
        </ul>

        <div 
            id="mobile-menu"
            class="absolute top-full left-0 right-0 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-700 shadow-lg md:hidden z-40"
        >
            <ul class="flex flex-col p-6 space-y-6">
                <li>
                    <a href="/the-rise-of-intelligence" class="block text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300 py-3 text-lg font-medium border-b border-gray-100 dark:border-gray-800">The Rise of Intelligence</a>
                </li>
                <li>
                    <a href="/blog" class="block text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300 py-3 text-lg font-medium border-b border-gray-100 dark:border-gray-800">บทความ</a>
                </li>
                <li>
                    <a href="/courses" class="block text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300 py-3 text-lg font-medium border-b border-gray-100 dark:border-gray-800">คอร์สเรียน</a>
                </li>
                <li class="flex items-center justify-between py-3 border-b border-gray-100 dark:border-gray-800">
                    <a
                        href="https://github.com/machines-school"
                        target="_blank"
                        class="flex items-center gap-2 text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300 text-lg font-medium"
                    >
                        <svg
                            viewBox="0 0 16 16"
                            aria-hidden="true"
                            width="20"
                            height="20"
                            ><path
                                fill="currentColor"
                                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
                            ></path></svg>
                        GitHub
                    </a>
                </li>
                <li class="flex items-center justify-center pt-4">
                    <ThemeIcon />
                </li>
            </ul>
        </div>
    </nav>
</header>

<style>
    #hamburger-button {
        position: relative;
        z-index: 60;
        pointer-events: auto;
    }
    
    .hamburger-active .hamburger-line:nth-child(1) {
        transform: rotate(45deg) translate(6px, 6px);
    }
    .hamburger-active .hamburger-line:nth-child(2) {
        opacity: 0;
    }
    .hamburger-active .hamburger-line:nth-child(3) {
        transform: rotate(-45deg) translate(6px, -6px);
    }
    
    #mobile-menu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-in-out;
    }
    
    #mobile-menu.mobile-menu-open {
        max-height: 500px;
    }

    /* Ensure hamburger button is clickable */
    @media (max-width: 768px) {
        #hamburger-button {
            z-index: 60 !important;
        }
    }
</style>

<script is:inline>
    function initHeader() {
        // Initialize hamburger menu
        const hamburgerButton = document.getElementById('hamburger-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (hamburgerButton && mobileMenu) {
            hamburgerButton.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                hamburgerButton.classList.toggle('hamburger-active');
                mobileMenu.classList.toggle('mobile-menu-open');
            });

            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                const target = event.target;
                // Only close if not clicking hamburger or menu, and not clicking theme toggle
                if (!hamburgerButton.contains(target) && 
                    !mobileMenu.contains(target) && 
                    !target.closest('#themeToggle')) {
                    hamburgerButton.classList.remove('hamburger-active');
                    mobileMenu.classList.remove('mobile-menu-open');
                }
            });
        }

        // Initialize theme toggle with event delegation
        document.addEventListener('click', (event) => {
            const target = event.target;
            
            // Check if clicked element is a theme toggle button or its child
            const themeButton = target.closest('#themeToggle');
            if (themeButton) {
                event.stopPropagation();
                const element = document.documentElement;
                element.classList.toggle("dark");

                const isDark = element.classList.contains("dark");
                if (typeof localStorage !== 'undefined') {
                    localStorage.setItem("theme", isDark ? "dark" : "light");
                }
                return;
            }
        });
    }

    // Run immediately and also on DOMContentLoaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initHeader);
    } else {
        initHeader();
    }
</script>
